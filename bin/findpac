#!/bin/zsh

usage() {
    cat <<EOF
    usage: findpac [-aAoOvV] <searchterms>
     -h, --help        this help
     -a, --aur         use the AUR [default]
     -A, --no-aur      don't use the AUR
     -o, --obsolete    show obsolete packages
     -O, --no-obsolete don't show obsolete packages [default]
     -v, --vote        sort by vote [default]
     -V, --no-vote     don't sort by vote (i.e. sort alphabetically)
EOF
    exit 0
}

opts=`getopt -o "aAoOvVh" -l "help,aur,no-aur,obsolete,no-obsolete,vote,no-vote" -- "$@"`
eval set -- "$opts"

aur=1
obsolete=0
vote=1

while [ -n "$1" ]; do
    case "$1" in
        -h|--help) usage() ; shift ;;
        -a|--aur) aur=1 ; shift ;;
        -A|--no-aur) aur=0 ; shift ;;
        -o|--obsolete) obsolete=1 ; shift ;;
        -O|--no-obsolete) obsolete=0 ; shift ;;
        -v|--vote) vote=1 ; shift ;;
        -V|--no-vote) vote=0 ; shift ;;
        --) shift ; break ;;
        *) echo "Invalid argument: $1" ; exit 1 ;;
    esac
done

if [ "$aur" = 1 ]; then
    mode="-Ssa"
else
    mode="-Ss"
fi

output=`yaourt $mode $@`
echo $output | grep '^aur/.*([0-9]*)$' | awk '/^aur\/([^ ]*).*\(([0-9]*)\)$/ { print $2 $1 }'
